# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö API –∫–ª—é—á–µ–π –∏ —Ç–æ–∫–µ–Ω–æ–≤

## üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:

### 1. ‚úÖ Supabase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `utils/supabase-config.js`

- ‚úÖ **URL**: `https://hmxqqewurxkptxflqjca.supabase.co` - **–£–ö–ê–ó–ê–ù –ü–†–ê–í–ò–õ–¨–ù–û**
- ‚úÖ **API Key**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` - **–£–ö–ê–ó–ê–ù –ü–†–ê–í–ò–õ–¨–ù–û**

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### 2. ‚úÖ Telegram Bot Token

**–§–∞–π–ª:** `bot.py`

- ‚úÖ **BOT_TOKEN**: `8478471129:AAGH5iaO6TTLVM8QnSdYCSzwvtQuzlN4qdk` - **–£–ö–ê–ó–ê–ù –ü–†–ê–í–ò–õ–¨–ù–û**

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –¢–æ–∫–µ–Ω —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### 3. ‚ö†Ô∏è Web App URL

**–§–∞–π–ª:** `bot.py`

- ‚ö†Ô∏è **WEB_APP_URL**: `https://your-app-name.netlify.app` - **–ù–£–ñ–ù–û –û–ë–ù–û–í–ò–¢–¨**

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
1. –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Netlify –ø–æ–ª—É—á–∏—Ç–µ –≤–∞—à URL
2. –û—Ç–∫—Ä–æ–π—Ç–µ `bot.py`
3. –ó–∞–º–µ–Ω–∏—Ç–µ `https://your-app-name.netlify.app` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

---

## üìã –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ:

### Supabase (–¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö):

1. ‚úÖ `utils/supabase-config.js` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
2. ‚úÖ –í—Å–µ HTML —Ñ–∞–π–ª—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç `supabase-config.js`
3. ‚úÖ `utils/trickle-api-supabase.js` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- URL —É–∫–∞–∑–∞–Ω: ‚úÖ
- API –∫–ª—é—á —É–∫–∞–∑–∞–Ω: ‚úÖ
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ‚úÖ

---

### Telegram Bot (–¥–ª—è –∫–æ–º–∞–Ω–¥):

1. ‚úÖ `bot.py` - —Ç–æ–∫–µ–Ω —É–∫–∞–∑–∞–Ω
2. ‚ö†Ô∏è `bot.py` - URL –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –¢–æ–∫–µ–Ω —É–∫–∞–∑–∞–Ω: ‚úÖ
- URL –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å: ‚ö†Ô∏è

---

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Supabase:

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12):

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
console.log('Supabase URL:', window.SUPABASE_CONFIG?.url);
console.log('Supabase Key:', window.SUPABASE_CONFIG?.anonKey ? '–£–∫–∞–∑–∞–Ω' : '–ù–ï —É–∫–∞–∑–∞–Ω');
console.log('Supabase –¥–æ—Å—Ç—É–ø–µ–Ω:', window.SUPABASE_CONFIG?.isAvailable());

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª–∏–µ–Ω—Ç
const client = window.SUPABASE_CONFIG?.getClient();
console.log('Supabase –∫–ª–∏–µ–Ω—Ç:', client ? '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω' : '–ù–ï –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
```

**–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:**
- URL: `https://hmxqqewurxkptxflqjca.supabase.co`
- Key: `–£–∫–∞–∑–∞–Ω`
- –î–æ—Å—Ç—É–ø–µ–Ω: `true` –∏–ª–∏ `false`
- –ö–ª–∏–µ–Ω—Ç: `–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω` –∏–ª–∏ `–ù–ï –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω`

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

### –¢–µ—Å—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏:

```javascript
// –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
trickleCreateObject('user_registration', {
  telegram_id: 'test_123',
  username: 'test_user',
  password: 'test_pass',
  first_name: 'Test',
  last_name: 'User',
  requested_role: 'client',
  status: 'pending'
}).then(result => {
  console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', result);
}).catch(error => {
  console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
});
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `user_registration` —Å–æ–∑–¥–∞–Ω–∞ –≤ Supabase
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ RLS –æ—Ç–∫–ª—é—á–µ–Ω –∏–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Supabase:

### –¢–∞–±–ª–∏—Ü–∞ `user_registration` –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –∫–æ–ª–æ–Ω–∫–∏:

- `id` (BIGSERIAL PRIMARY KEY)
- `telegram_id` (TEXT)
- `username` (TEXT NOT NULL)
- `password` (TEXT NOT NULL)
- `email` (TEXT) - **–¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏–µ–π**
- `first_name` (TEXT NOT NULL)
- `last_name` (TEXT NOT NULL)
- `requested_role` (TEXT NOT NULL)
- `status` (TEXT NOT NULL DEFAULT 'pending')
- `approved_role` (TEXT)
- `registration_date` (TIMESTAMPTZ)
- `created_at` (TIMESTAMPTZ)
- `updated_at` (TIMESTAMPTZ)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase ‚Üí Table Editor
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `user_registration`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏ –µ—Å—Ç—å

---

## ‚ùå –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–∫—Ä–∏–ø—Ç Supabase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ HTML:
   ```html
   <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "relation does not exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ –≤ Supabase

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `supabase-migration-add-email.sql`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "new row violates row-level security"

**–ü—Ä–∏—á–∏–Ω–∞:** RLS –≤–∫–ª—é—á–µ–Ω –±–µ–∑ –ø–æ–ª–∏—Ç–∏–∫

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫–ª—é—á–∏—Ç–µ RLS: `ALTER TABLE user_registration DISABLE ROW LEVEL SECURITY;`
2. –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –≤ –º–∞–ø–ø–∏–Ω–≥–µ –ø–æ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü—ã

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:

- [ ] Supabase URL —É–∫–∞–∑–∞–Ω –≤ `utils/supabase-config.js`
- [ ] Supabase API –∫–ª—é—á —É–∫–∞–∑–∞–Ω –≤ `utils/supabase-config.js`
- [ ] Telegram Bot —Ç–æ–∫–µ–Ω —É–∫–∞–∑–∞–Ω –≤ `bot.py`
- [ ] Web App URL –æ–±–Ω–æ–≤–ª–µ–Ω –≤ `bot.py` (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)
- [ ] –¢–∞–±–ª–∏—Ü–∞ `user_registration` —Å–æ–∑–¥–∞–Ω–∞ –≤ Supabase
- [ ] –ö–æ–ª–æ–Ω–∫–∞ `email` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—É
- [ ] –¢–∞–±–ª–∏—Ü–∞ `password_reset_tokens` —Å–æ–∑–¥–∞–Ω–∞
- [ ] RLS –æ—Ç–∫–ª—é—á–µ–Ω –∏–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –°–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ HTML —Ñ–∞–π–ª–∞—Ö
- [ ] –ö–æ–Ω—Å–æ–ª—å –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫

---

## üéØ –ò—Ç–æ–≥:

**–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

- ‚úÖ Supabase: URL –∏ –∫–ª—é—á —É–∫–∞–∑–∞–Ω—ã
- ‚úÖ Telegram Bot: —Ç–æ–∫–µ–Ω —É–∫–∞–∑–∞–Ω
- ‚ö†Ô∏è Web App URL: –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

**–ï—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –Ω–∞ –æ—à–∏–±–∫–∏
2. –¢–∞–±–ª–∏—Ü—ã –≤ Supabase —Å–æ–∑–¥–∞–Ω—ã
3. RLS –æ—Ç–∫–ª—é—á–µ–Ω

---

**–í—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–µ—Å—Ç–µ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏!** üîç

